<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Airwaybill</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" />
</head>

<body>
	<div class="ui container">
		<form class="ui form">
			<div class="ui segment">
				<h4 class="ui dividing header">Shipper Information</h4>
				<div class="two fields">
					<div class="field">
						<label>Account</label>
						<input type="text" placeholder="Account Number" id="ship_account" data-bind="ship_account">
					</div>
					<div class="field">
						<label>Reference</label>
						<input type="text" placeholder="Reference" id="ship_reference" data-bind="ship_reference">
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>Name</label>
						<input type="text" placeholder="Shipper Name" id="ship_name" data-bind="ship_name">
					</div>
					<div class="field">
						<label>Company</label>
						<input type="text" placeholder="Company Name" id="ship_company_name" data-bind="ship_company_name">
					</div>
				</div>
				<div class="field">
						<label>Address</label>
					<input type="text" placeholder="Shipper Address" id="ship_address" data-bind="ship_address">
				</div>
				<div class="three fields">
					<div class="field">
						<label>City</label>
						<input type="text" placeholder="Shipper City" id="ship_city" data-bind="ship_city">
					</div>
					<div class="field">
						<label>State</label>
						<input type="text" placeholder="Company State" id="ship_state" data-bind="ship_state">
					</div>
					<div class="field">
						<label>Postal Code</label>
						<input type="text" placeholder="Postal Code" id="ship_zip" data-bind="ship_zip">
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>Country Code</label>
						<input type="text" placeholder="Shipper Country Code" id="ship_country" data-bind="ship_country">
					</div>
					<div class="field">
						<label>Phone</label>
						<input type="text" placeholder="Shipper Telephone" id="ship_phone" data-bind="ship_phone">
					</div>
				</div>
			</div>

			<div class="ui segment">
				<h4 class="ui dividing header">Consignee Information</h4>
				<div class="two fields">
					<div class="field">
						<label>Name</label>
						<input type="text" placeholder="Consignee Name" id="con_name" data-bind="con_name">
					</div>
					<div class="field">
						<label>Company</label>
						<input type="text" placeholder="Company Name" id="con_company_name" data-bind="con_company_name">
					</div>
				</div>
				<div class="field">
						<label>Address</label>
					<input type="text" placeholder="Consignee Address" id="con_address" data-bind="con_address">
				</div>
				<div class="three fields">
					<div class="field">
						<label>City</label>
						<input type="text" placeholder="Consignee City" id="con_city" data-bind="con_city">
					</div>
					<div class="field">
						<label>State</label>
						<input type="text" placeholder="Consignee State" id="con_state" data-bind="con_state">
					</div>
					<div class="field">
						<label>Postal Code</label>
						<input type="text" placeholder="Consignee Code" id="con_zip" data-bind="con_zip">
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>Country Code</label>
						<input type="text" placeholder="Consignee Country Code" id="con_country" data-bind="con_country">
					</div>
					<div class="field">
						<label>Phone</label>
						<input type="text" placeholder="Consignee Telephone" id="con_phone" data-bind="con_phone">
					</div>
				</div>
			</div>

			<div class="ui segment">
				<h4 class="ui dividing header">Shipment Information</h4>
				<div class="field">
					<label>Description</label>
					<input type="text" placeholder="Description" id="description" data-bind="description">
				</div>
				<div class="two fields">
					<div class="field">
						<label>Weight</label>
						<input type="text" placeholder="Weight" id="weight" data-bind="weight">
					</div>
					<div class="field">
						<label>Weight Unit</label>
						<select class="ui dropdown" id="weight_qualifier" data-bind="weight_qualifier">
						  <option value="lbs">Pounds</option>
						  <option value="kgs">Kilograms</option>
						</select>
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>Pieces</label>
						<input type="text" placeholder="Pieces" id="pieces" data-bind="pieces">
					</div>
					<div class="field">
						<label>Value $</label>
						<input type="text" placeholder="Value" id="value" data-bind="value">
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>Type</label>
						<select class="ui dropdown" id="contents" data-bind="contents">
							<option value="DOC">Documents</option>
							<option value="APX">Dutiable</option>
						</select>
					</div>
					<div class="field">
						<label>Packaging</label>
						<select class="ui dropdown" id="packaging" data-bind="packaging">
							<option value="P">Package</option>
							<option value="L">Letter</option>
							<option value="B">Box</option>
							<option value="O">Other</option>
						</select>
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>Service</label>
						<select class="ui dropdown" id="service" data-bind="service">
							<option value="ST">Standard Courier</option>
							<option value="GD">Ground</option>
							<option value="P1">Priority</option>
							<option value="DS">Deferred</option>
						</select>
					</div>
					<div class="field">
						<label>Payment</label>
						<select class="ui dropdown" id="bill_to" data-bind="bill_to">
							<option value="P">Pre Pay</option>
							<option value="C">Collect</option>
							<option value="F">Free Domicile</option>
						</select>
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>Dimmensions</label>
						<input type="text" placeholder="L x W x H" id="dimensions" data-bind="dimensions">
					</div>
					<div class="field" style="margin-top: 25px;">
						<button class="ui blue button">Create</button>
						<button class="ui red button">Reset</button>
					</div>
				</div>
				<div class="ui error message"></div>
			</div>





		</form>

<!--
		Reference: <span data-bind="ship_reference"></span><br/>
		Account: <span data-bind="ship_account"></span>
-->
	</div>

	<div id="tag" class="ui top left attached label"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
<script src="https://cdn.rawgit.com/tiaanduplessis/jquery-bindings/master/jquery-bindings.min.js"></script>
<script>
var app={
	id:"1582259620409687162",
	logo: "",
	address: "",
	website: "",
	input: $.bindings({
			"ship_name":"",
			"ship_company_name":"",
			"ship_phone":"",
			"ship_address":"",
			"ship_city":"",
			"ship_state":"",
			"ship_zip":"",
			"ship_country":"",
			"ship_account":"",
			"ship_reference":"",
			"con_name":"",
			"con_company_name":"",
			"con_phone":"",
			"con_address":"",
			"con_city":"",
			"con_state":"",
			"con_zip":"",
			"con_country":"",
			"con_email":"",
			"con_tax_id":"",
			"weight":"",
			"value":"",
			"description":"",
			"pieces":"",
			"dimensions":"",
			"contents":"DOC",
			"packaging":"P",
			"weight_qualifier":"lbs",
			"service":"ST",
			"bill_to":"P",
			"dimensions_qualifier": "inch"
	}),
	zip_countries: [ 'US', 'CA' ]
};

function reset(){
	const keys = Object.keys( app.input );
	for (var property in app.input) {
	  if( app.input.hasOwnProperty( property ) ) {
			app.input[ property ] = "";
	  }
	}
	app.input.contents = "DOC";
	app.input.packaging = "P";
	app.input.weight_qualifier = "lbs";
	app.input.service = "ST";
	app.input.bill_to = "P";
	app.input.dimensions_qualifier = "inch";
	$( '.ui.form' ).form( 'reset' );
}

function toServiceJSON(){
	var billData = {
		"shipper": {
			"name": app.input.ship_name,
			"company_name": app.input.ship_company_name,
			"phone": app.input.ship_phone,
			"address": app.input.ship_address,
			"city": app.input.ship_city,
			"state": app.input.ship_state,
			"zip": app.input.ship_zip,
			"country": app.input.ship_country,
			"account": app.input.ship_account
		 },
		"consignee": {
			"name": app.input.con_name,
			"company_name": app.input.con_company_name,
			"phone": app.input.con_phone,
			"address": app.input.con_address,
			"city": app.input.con_city,
			"state": app.input.con_state,
			"zip": app.input.con_zip,
			"country": app.input.con_country,
			"email": "",
			"tax_id": ""
		},
		"shipment": {
			"contents": app.input.contents,
			"description": app.input.description,
			"pieces": app.input.pieces,
			"packaging": app.input.packaging,
			"weight": app.input.weight,
			"weight_qualifier": app.input.weight_qualifier,
			"value": app.input.value,
			"service": app.input.service,
			"bill_to": app.input.bill_to,
			"platinum_service": "",
			"insurance_amount": "",
			"dimensions": app.input.dimmensions,
			"dimensions_qualifier": app.input.dimensions_qualifier,
			"tracking": ""
		}
	}
	return billData;

}
function setupFormValidations(){
	//custom
	$.fn.form.settings.rules.requires_stzip = function( value, input ) {
		var result = false;
		var v = input == 0 ? app.input.con_country : app.input.ship_country;
		if( app.zip_countries.includes( v ) ){
			if( '' === value.trim() ){
				result = true;
			}
		}
		return !result;
	};

	$( '.ui.form' ).form({ on: 'blur', inline: true,
    fields: {
			ship_account: {
					identifier: 'ship_account',
        	rules: [{
          	type   : 'regExp[/^\\d{4}$/]',
          	prompt : 'Account must be 4 numeric digits'
          }]
      },
			ship_name: {
					identifier: 'ship_name',
					rules: [{
						type   : 'empty'
					}]
			},
			ship_address: {
					identifier: 'ship_address',
					rules: [{
						type   : 'empty'
					}]
			},
			ship_city: {
					identifier: 'ship_city',
					rules: [{
						type   : 'empty'
					}]
			},
			ship_state: {
				identifier: 'ship_state',
				rules: [{
					type  	: 'requires_stzip[1]',
					prompt  :	'A state name is required when shipping from this country'
				}]
			},
			ship_zip: {
				identifier: 'ship_zip',
				rules: [{
					type  	: 'requires_stzip[1]',
					prompt  :	'A postal code is required when shipping from this country'
				}]
			},
			ship_country: {
					identifier: 'ship_country',
					rules: [{
						type   : 'regExp[/^[a-zA-Z]{2}$/]',
						prompt : '{name} should be the ISO two letter country code'
					}]
			},
			con_name: {
					identifier: 'con_name',
					rules: [{
						type   : 'empty'
					}]
			},
			con_address: {
					identifier: 'con_address',
					rules: [{
						type   : 'empty'
					}]
			},
			con_city: {
					identifier: 'con_city',
					rules: [{
						type   : 'empty'
					}]
			},
			con_state: {
				identifier: 'con_state',
				rules: [{
					type  	: 'requires_stzip[0]',
					prompt  :	'A state name is required when shipping to this country'
				}]
			},
			con_zip: {
				identifier: 'con_zip',
				rules: [{
					type  	: 'requires_stzip[0]',
					prompt  :	'A postal code is required when shipping to this country'
				}]
			},
			con_country: {
					identifier: 'con_country',
					rules: [{
						type   : 'regExp[/^[a-zA-Z]{2}$/]',
						prompt : '{name} should be the ISO two letter country code'
					}]
			},
    }
  });
}
function init(){
	$( "#tag" ).text( app.id );
	$( ".blue.button" ).click( function( e ){
		e.preventDefault();
		$( '.ui.form' ).form( 'validate form' );
		if( $( '.ui.form' ).form('is valid')) {
			console.log( toServiceJSON() );
			console.log( "blue click");
		}else{
			$( ".error.message" ).html( "Your form entry is not complete" );
		}

	});
	$( ".red.button" ).click( function( e ){
		e.preventDefault();
		reset();
		console.log( toServiceJSON() );
		console.log( "red click");
		$( ".error.message" ).empty();
	});
	setupFormValidations();
}
$(function(){
	init();
});
</script>
</body>

</html>
